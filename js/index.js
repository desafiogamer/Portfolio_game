const joystick=document.getElementById("joystick"),stick=document.getElementById("stick");let stickOffsetX=0,stickOffsetY=0,isJoystickActive=!1;function pressKey(e){let t=new KeyboardEvent("keydown",{key:e});document.dispatchEvent(t)}function releaseKey(e){let t=new KeyboardEvent("keyup",{key:e});document.dispatchEvent(t)}function moveStick(e,t){let n=joystick.getBoundingClientRect(),s=n.left+n.width/2,l=n.top+n.height/2,i=e-s,r=t-l,c=Math.sqrt(i*i+r*r),a=Math.min(n.width,n.height)/2-25;if(c>a){let o=a/c;e=s+i*o,t=l+r*o}stick.style.transform=`translate(${e-stickOffsetX}px, ${t-stickOffsetY}px)`;let u=Math.atan2(r,i)*(180/Math.PI);u>=-135&&u<-45?(releaseKey("d"),releaseKey("s"),releaseKey("a"),pressKey("w")):u>=-45&&u<45?(releaseKey("w"),releaseKey("s"),releaseKey("a"),pressKey("d")):u>=45&&u<135?(releaseKey("w"),releaseKey("a"),releaseKey("d"),pressKey("s")):(releaseKey("w"),releaseKey("d"),releaseKey("s"),pressKey("a"))}joystick.addEventListener("touchstart",e=>{if(e.preventDefault(),!isJoystickActive){isJoystickActive=!0;let t=e.touches[0];joystick.getBoundingClientRect(),stickOffsetX=t.clientX,stickOffsetY=t.clientY,stick.style.transition="none",moveStick(t.clientX,t.clientY)}}),joystick.addEventListener("touchmove",e=>{if(e.preventDefault(),isJoystickActive){let t=e.touches[0];moveStick(t.clientX,t.clientY)}}),joystick.addEventListener("touchend",e=>{e.preventDefault(),isJoystickActive&&(isJoystickActive=!1,stick.style.transition="transform 0.1s ease-out",stick.style.transform="translate(0, 0)",releaseKey("w"),releaseKey("a"),releaseKey("s"),releaseKey("d"))});